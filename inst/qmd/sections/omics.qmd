

```{r get omics data from loni}
#| echo: false
#| eval: !expr (params$omics) & (!is.null(params$lonidir))
#| results: asis

abcdsReporter:::format_quarto("Omics Data from LONI", type = "subsection")

metabolomics <- readr::read_csv(
  list.files(
    params$lonidir,
    pattern = "ABCDS_targeted_metabolomics_unadjusted",
    full.names = TRUE
  ),
  show_col_types = FALSE
)

proteomics <- readr::read_csv(
  list.files(
    params$lonidir,
    pattern = "ABCDS_Proteomics_Results_Freeze5_15Oct2025",
    full.names = TRUE
  ),
  show_col_types = FALSE
)

proteomics_tbl <- proteomics %>%
  dplyr::filter(!is.na(subject_label)) %>%
  dplyr::distinct(subject_label, event_sequence) %>%
  dplyr::group_by(event_sequence) %>%
  dplyr::count() %>%
  dplyr::mutate(
    `Omics Type` = "Proteomics",
    event_sequence = paste0("Event Sequence ", event_sequence)
  )


metabolomics_tbl <- metabolomics %>%
  dplyr::distinct(subject_label, event_sequence) %>%
  dplyr::group_by(event_sequence) %>%
  dplyr::count() %>%
  dplyr::mutate(
    `Omics Type` = "Metabolomics",
    event_sequence = paste0("Event Sequence ", event_sequence)
  )

proteomics_tbl %>%
  rbind(metabolomics_tbl) %>%
  dplyr::rename(`Event Sequence` = event_sequence) %>%
  tidyr::pivot_wider(
    names_from = `Omics Type`,
    values_from = n,
    values_fill = 0
  ) %>%
  flextable::flextable() %>%
  abcdsReporter:::ft_add_abcds_theme() %>%
  flextable::width(width = 5.25 / 3)

```

```{r retreiving demographics from atri}
#| echo: false
#| eval: !expr params$demographics
#| results: asis

abcdsReporter:::format_quarto("Demographics", "subsection")

demographics <- abcdsReporter::get_demographics(
  age_at_visit,
  de_race,
  de_gender,
  de_ethnicity,
  site = NULL,
  cycle = NULL,
  apply_labels = TRUE
)

demographics %>%
  dplyr::mutate(de_race = NA) %>%
  dplyr::select(
    age_at_visit,
    de_gender,
    de_ethnicity,
    de_race,
    `White `:`Native Hawaiian/Other Pacific Islander`
  ) %>%
  dplyr::mutate(
    de_gender = forcats::fct_drop(de_gender),
    de_ethnicity = forcats::fct_drop(de_ethnicity),
    de_race = "",
  ) %>%
  gtsummary::tbl_summary(
    missing = "no",
    label = list(age_at_visit ~ "Age (Years)", de_race = "Race"),
    statistic = list(gtsummary::all_continuous() ~ "{mean} ± {sd}"),
    digits = list(gtsummary::all_continuous() ~ 1)
  ) %>%
  gtsummary::as_tibble() %>%
  dplyr::filter(.[[1]] != "") %>%
  flextable::flextable() %>%
  flextable::set_header_labels(
    values = c("Variable", paste0("N = ", nrow(demographics)))
  ) %>%
  abcdsReporter:::ft_add_abcds_theme() %>%
  flextable::bold(i = c(1:2, 5:6), j = 1) %>%
  flextable::width(j = 1, width = 4) %>%
  flextable::width(j = 2, width = 1.5)

abcdsReporter:::format_quarto(type = "newpage")

```
